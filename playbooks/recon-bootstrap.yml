# Use this playbook whenever you spinup a new VPS
---
- hosts: recon
  vars_prompt:
    - name: "proceed_with_play"
      prompt: "Have you set the correct variables, including the ssh key for the vps using eval and the current Go version in the playbook? (yes/no)"
      private: false

  pre_tasks:
    - name: End play if user declines
      meta: end_play
      when: proceed_with_play | lower == 'no'

    - name: This task will only run if the user chose 'yes'
      debug:
        msg: "Proceeding with the play!"

  vars:
    docker_install_compose_plugin: true
    docker_compose_package: docker-compose-plugin
    docker_compose_package_state: present
    docker_add_repo: true
    ansible_become_pass: "{{ lookup('ansible.builtin.file', '/home/sociodicy/scripts/ansible/secrets/vps.yml') }}"

  roles:
    - apt_update_vps
    - basics_vps
    - rustup
    - rustapps_vps
    - go_vps
    - nfs
    - navi
    - role: go_tools
      vars:
        go_version: "1.25.5"
        go_binaries:
          - name: httpx
            package: github.com/projectdiscovery/httpx/releases/latest
          - name: gobuster
            package: github.com/OJ/gobuster/releases/latest
          - name: subfinder
            package: github.com/projectdiscovery/subfinder/releases/latest
          - name: gau
            package: github.com/lc/gau/releases/latest
          - name: ffuf
            package: github.com/ffuf/ffuf/releases/
          - name: httprobe
            package: github.com/tomnomnom/httprobe/releases/latest
          - name: meg
            package: github.com/tomnomnom/meg/releases/latest
          - name: unfurl
            package: github.com/tomnomnom/unfurl/releases/latest
          - name: interactsh-server
            package: github.com/projectdiscovery/interactsh/cmd/interactsh-server@latest
          - name: interactsh-client
            package: github.com/projectdiscovery/interactsh/cmd/interactsh-client@latest
    - role: geerlingguy.docker
      become: true

  post_tasks:
    - name: Send ntfy update
      uri:
        url: "http://192.168.1.61/homelab"
        method: POST
        body: "recon bootstrap complete"
