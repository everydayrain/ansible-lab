# Use this playbook whenever you spinup a new VPS
---
- hosts: recon
  vars_prompt:
    - name: "proceed_with_play"
      prompt: "Have you set the ssh key for the vps using eval? (yes/no)"
      private: false

  pre_tasks:
    - name: End play if user declines
      meta: end_play
      when: proceed_with_play | lower == 'no'

    - name: This task will only run if the user chose 'yes'
      debug:
        msg: "Proceeding with the play!"

  vars:
    docker_install_compose_plugin: true
    docker_compose_package: docker-compose-plugin
    docker_compose_package_state: present
    docker_add_repo: true
    ansible_become_pass: "{{ lookup('ansible.builtin.file', '/home/sociodicy/scripts/ansible/secrets/vps.yml') }}"

  roles:
    - apt_update_vps
    - basics_vps
    - rustup
    - rustapps_vps
    - go_vps
    - nfs
    - role: geerlingguy.docker
      become: true

  post_tasks:
    - name: Send ntfy update
      uri:
        url: "http://192.168.1.61/homelab"
        method: POST
        body: "recon bootstrap complete"
